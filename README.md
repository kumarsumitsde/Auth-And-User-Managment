üß± PROJECT STRUCTURE & ARCHITECTURE

(Spring Boot Microservices with API Gateway)

1Ô∏è‚É£ Project Overview

This project is a microservices-based backend system built using Spring Boot and Spring Cloud.

It follows real-world enterprise architecture, where:

All client requests go through API Gateway

Security is handled using JWT

Authorization is role-based

Services communicate internally using WebClient

Email notifications are sent on user signup

2Ô∏è‚É£ High-Level Architecture
CLIENT (Postman / Frontend)
        |
        v
-------------------------
|     API GATEWAY      |  (9005)
-------------------------
   |        |        |
   v        v        v
AUTH     USER     PRODUCT
(9001)   (9000)   (9004)
             |
             v
         EMAIL SERVICE
            (9002)


Optional:

EUREKA SERVER (8083)

3Ô∏è‚É£ Services & Ports
Service Name	Port	Responsibility
API Gateway	9005	Entry point, JWT validation, authorization, routing
Auth Service	9001	Login, JWT token generation
User Service	9000	User CRUD, signup
Email Service	9002	Send confirmation emails
Product Service	9004	Product APIs with role rules
Eureka Server	8083	Service discovery (optional)
4Ô∏è‚É£ API Gateway ‚Äì Project Structure
api-gateway
 ‚îî‚îÄ‚îÄ src/main/java
     ‚îî‚îÄ‚îÄ com.api_gateway.api_gateway
         ‚îú‚îÄ‚îÄ ApiGatewayApplication.java
         ‚îú‚îÄ‚îÄ filter
         ‚îÇ    ‚îî‚îÄ‚îÄ JwtAuthorizationFilter.java
         ‚îî‚îÄ‚îÄ util
              ‚îî‚îÄ‚îÄ JwtUtil.java
 ‚îî‚îÄ‚îÄ src/main/resources
     ‚îî‚îÄ‚îÄ application.properties
 ‚îî‚îÄ‚îÄ pom.xml

5Ô∏è‚É£ API Gateway Responsibilities
‚úÖ What Gateway Does

Central entry point

JWT token validation

Role-based authorization

Route request to correct service

‚ùå What Gateway Does NOT Do

No database access

No business logic

No email sending

No product/user logic

6Ô∏è‚É£ JWT Token Design

JWT is generated by Auth Service and contains:

{
  "userId": 1,
  "role": "NORMAL | ENTERPRISE | ADMIN",
  "iat": 1710000000,
  "exp": 1710003600
}


Client sends token in header:

Authorization: Bearer <JWT_TOKEN>

7Ô∏è‚É£ Public vs Protected APIs
üîì Public APIs (NO TOKEN REQUIRED)
Service	Endpoint
Auth Service	/auth/login
Auth Service	/auth/register
üîí Protected APIs (TOKEN REQUIRED)
Service	Path
User Service	/users/**
Product Service	/products/**

Any request not starting with /auth requires a JWT token.

8Ô∏è‚É£ Routing Configuration (API Gateway)
/auth/**     ‚Üí http://localhost:9001
/users/**    ‚Üí http://localhost:9000
/products/** ‚Üí http://localhost:9004


Configured using spring.cloud.gateway.routes.

9Ô∏è‚É£ Role-Based Access Rules (IMPORTANT)
Roles in System

NORMAL

ENTERPRISE

ADMIN

üõí Product Service Authorization Rules
Role	Allowed HTTP Methods
NORMAL	GET
ENTERPRISE	GET, POST, PUT
ADMIN	GET, POST, PUT, DELETE

‚ùå If rule violated ‚Üí 403 FORBIDDEN

These checks are done ONLY in API Gateway
Product Service trusts Gateway.

üîü Why /users/** Requires Token

Gateway logic:

if (!path.startsWith("/auth")) {
   // JWT REQUIRED
}


So:

/users/** ‚Üí protected

/products/** ‚Üí protected

/auth/** ‚Üí public

This is intentional and correct.

1Ô∏è‚É£1Ô∏è‚É£ User Signup Flow (With Email)
Signup Flow
Client
  |
  v
API Gateway
  |
  v
User Service
  |
  |-- Save user in DB
  |
  |-- Call Email Service (WebClient)
  |
  v
Email Service ‚Üí Send confirmation email

1Ô∏è‚É£2Ô∏è‚É£ Email Service Details

Port: 9002

Called internally

Triggered when:

User signs up

Communication:

User Service ‚Üí Email Service using WebClient (GET/POST)

1Ô∏è‚É£3Ô∏è‚É£ Why Role Is NOT Sent to Other Services

Role is security-sensitive

Authorization happens at API Gateway

Downstream services stay simple & secure

Only optional header passed:

X-User-Id

1Ô∏è‚É£4Ô∏è‚É£ Example CURL Requests
Login
curl -X POST http://localhost:9005/auth/login

Get User (Protected)
curl -X GET http://localhost:9005/users/email/sumit@gmail.com \
-H "Authorization: Bearer <TOKEN>"

Get Products (NORMAL allowed)
curl -X GET http://localhost:9005/products \
-H "Authorization: Bearer <TOKEN>"

Create Product (NORMAL blocked)
curl -X POST http://localhost:9005/products \
-H "Authorization: Bearer <NORMAL_TOKEN>"

1Ô∏è‚É£5Ô∏è‚É£ Why This Architecture Is Correct

‚úî Industry-standard
‚úî Scalable
‚úî Secure
‚úî Clean separation of concerns
‚úî Easy to extend (payments, orders, etc.)

1Ô∏è‚É£6Ô∏è‚É£ Final Summary

API Gateway ‚Üí Security + Routing

Auth Service ‚Üí JWT generation

User Service ‚Üí User management + email trigger

Email Service ‚Üí Notifications

Product Service ‚Üí Business logic

Role checks ‚Üí Gateway only
